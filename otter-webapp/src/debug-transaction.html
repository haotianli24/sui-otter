<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .test-button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .log {
            background: #e2e3e5;
            color: #383d41;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Transaction Detection Debug</h1>

        <div class="test-section">
            <h3>Test Transaction Detection</h3>
            <p>Enter a transaction digest to test detection and fetching:</p>
            <input type="text" id="digestInput" class="test-input"
                placeholder="Enter transaction digest (e.g., 2k5J8abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789)">
            <button onclick="testTransactionDetection()" class="test-button">Test Detection</button>
            <div id="detectionResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test Transaction Fetching</h3>
            <p>Test fetching transaction data from Sui blockchain:</p>
            <input type="text" id="fetchInput" class="test-input" placeholder="Enter transaction digest">
            <button onclick="testTransactionFetch()" class="test-button">Fetch Transaction</button>
            <div id="fetchResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test Cache</h3>
            <p>Test transaction cache functionality:</p>
            <button onclick="testCache()" class="test-button">Test Cache</button>
            <button onclick="clearCache()" class="test-button">Clear Cache</button>
            <div id="cacheResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Console Logs</h3>
            <p>Recent console output:</p>
            <div id="consoleLogs" class="result log"></div>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('consoleLogs');

        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        console.log = function (...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };

        console.error = function (...args) {
            originalError.apply(console, error, args);
            addLog(args.join(' '), 'error');
        };

        // Test transaction detection
        function testTransactionDetection() {
            const digest = document.getElementById('digestInput').value;
            const resultDiv = document.getElementById('detectionResult');

            if (!digest) {
                resultDiv.innerHTML = '<div class="error">Please enter a transaction digest</div>';
                resultDiv.style.display = 'block';
                return;
            }

            // Test the detection regex
            const suiPattern = /\b[A-HJ-NP-Za-km-z1-9]{43,44}\b/g;
            const hexPattern = /0x[a-fA-F0-9]{64}/g;

            const suiMatch = digest.match(suiPattern);
            const hexMatch = digest.match(hexPattern);

            let result = `<strong>Input:</strong> ${digest}<br>`;
            result += `<strong>Sui Pattern Match:</strong> ${suiMatch ? suiMatch[0] : 'No match'}<br>`;
            result += `<strong>Hex Pattern Match:</strong> ${hexMatch ? hexMatch[0] : 'No match'}<br>`;

            if (suiMatch || hexMatch) {
                result += '<div class="success">✓ Transaction digest detected!</div>';
            } else {
                result += '<div class="error">✗ No transaction digest detected</div>';
            }

            resultDiv.innerHTML = result;
            resultDiv.style.display = 'block';
        }

        // Test transaction fetching
        async function testTransactionFetch() {
            const digest = document.getElementById('fetchInput').value;
            const resultDiv = document.getElementById('fetchResult');

            if (!digest) {
                resultDiv.innerHTML = '<div class="error">Please enter a transaction digest</div>';
                resultDiv.style.display = 'block';
                return;
            }

            resultDiv.innerHTML = '<div>Fetching transaction data...</div>';
            resultDiv.style.display = 'block';

            try {
                // This would need to be imported from the actual module
                // For now, just show that we're testing
                resultDiv.innerHTML = '<div class="error">Transaction fetching test requires module imports. Check browser console for actual implementation.</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Test cache
        function testCache() {
            const resultDiv = document.getElementById('cacheResult');
            const testKey = 'test_transaction_123';
            const testData = { digest: testKey, explanation: 'Test explanation', timestamp: Date.now().toString() };

            try {
                // Test cache set
                localStorage.setItem(`transaction_cache_${testKey}`, JSON.stringify(testData));

                // Test cache get
                const retrieved = localStorage.getItem(`transaction_cache_${testKey}`);
                const parsed = JSON.parse(retrieved);

                let result = '<strong>Cache Test Results:</strong><br>';
                result += `✓ Set cache: ${testKey}<br>`;
                result += `✓ Retrieved: ${parsed.digest}<br>`;
                result += `✓ Data intact: ${parsed.explanation === testData.explanation ? 'Yes' : 'No'}<br>`;

                // Clean up
                localStorage.removeItem(`transaction_cache_${testKey}`);

                result += '<div class="success">✓ Cache test passed!</div>';
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Cache test failed: ${error.message}</div>`;
            }

            resultDiv.style.display = 'block';
        }

        // Clear cache
        function clearCache() {
            const resultDiv = document.getElementById('cacheResult');

            try {
                const keys = Object.keys(localStorage);
                let cleared = 0;

                keys.forEach(key => {
                    if (key.startsWith('transaction_cache_')) {
                        localStorage.removeItem(key);
                        cleared++;
                    }
                });

                resultDiv.innerHTML = `<div class="success">✓ Cleared ${cleared} cached transactions</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error clearing cache: ${error.message}</div>`;
            }

            resultDiv.style.display = 'block';
        }

        // Initialize
        console.log('Transaction Debug Page Loaded');
    </script>
</body>

</html>
